{% extends 'derb/base.html' %}

{% block main_block %}
  <div class="row">
    <div class="col-md-offset-2 col-md-8">
      <!-- Message Area -->
      {% for message in messages %}
        {% if message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %}
          <div class="alert alert-success">
            <strong>Success:</strong> {{ message }}
          </div>
        {% endif %}
        {% if message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}
          <div class="alert alert-danger">
            <strong>Error:</strong> {{ message }}
          </div>
        {% endif %}
      {% endfor %}

      <!-- Panel View -->
      <div class="panel panel-info">
        <div class="panel-heading">
          Unique Selection Question (Admin)
        </div>

        <div class="panel-body">
          <form action="{% url 'report_builder:unique_selection_admin' %}" method="post">
            {% csrf_token %}
            <div class="row">
              <!-- Question Area -->
              <div class="col-md-8">
                <div> {{ form.text }} </div>
                <br/>
                <div> {{ form.help }} </div>
                <br/>

                <div id="display_fields">
                  <h4 align="center"><strong>Display fields</strong></h4>
                  <p><strong>Catalog: </strong><span id="catalog_name"></span></p>
                  <div id='asdx'>
                    {{ form.display_fields }}
                  </div>
                </div>
              </div>

              <!-- Buttons Area -->
              <div class="col-md-4 question_option_panel text-center" style="background-color: #DFDCDC">
                <div class="btn-group">
                  <button onclick="toggle_help_input();" type="button" class="btn btn-primary">
                    See/Hide
                  </button>
                  <button type="button" class="btn btn-danger">
                    Delete
                  </button>
                  <button type="button" class="btn btn-success">
                    #
                  </button>
                </div>
                <br/><br/><br/>

                Requirement: {{ form.required }}
                <br/><br/><br/><br/>

                Catalog: {{ form.catalog }}
                <br/><br/><br/><br/>
                <br/><br/><br/><br/>
                <br/><br/><br/><br/>
                <br/><br/><br/><br/>
              </div>
            </div>

            <!-- Submit -->
            <div class="row text-right">
              <div class="col-md-12">
                <input class="btn btn-primary" type="submit" value="Save">
              </div>
            </div>

          </form>

        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block body_js %}
  <script type="application/javascript">
    function toggle_help_input() {
      $("#id_help").toggle();
    }

    $(document).ready(function () {
      $("#id_catalog option:selected").each(function () {
        $('#catalog_name').html($(this).text());
        var catalog_id = $(this).val();
        $.ajax({
          url: "/get_catalog_display_fields/",
          type: 'GET',
          data: {
            catalog_id: catalog_id
          },
          success: function (data) {
            $('#asdx').html('');

            var display_fields = data.content;
            var html = '';
            var count = 0;
            var id = '';
            for (var i = 0; i < display_fields.length; i++) {
              id = 'id_display_fields_' + count;
              html += '<ul><li><label for="' + id + '"><input id="' + id + '" type="checkbox" value="' + display_fields[i][0] + '" name="display_fields"> ' + display_fields[i][1] + '</label></li></ul>';
              count++;
            }
            console.log(html);
            $('#asdx').html(html);
          }
        });
      });

      $("#id_catalog").change(function () {
        $("#id_catalog option:selected").each(function () {
          $('#catalog_name').html($(this).text());
          var catalog_id = $(this).val();
          $.ajax({
            url: "/get_catalog_display_fields/",
            type: 'GET',
            data: {
              catalog_id: catalog_id
            },
            success: function (data) {
              $('#asdx').html('');

              var display_fields = data.content;
              var html = '';
              var count = 0;
              var id = '';
              for (var i = 0; i < display_fields.length; i++) {
                id = 'id_display_fields_' + count;
                html += '<ul><li><label for="' + id + '"><input id="' + id + '" type="checkbox" value="' + display_fields[i][0] + '" name="display_fields"> ' + display_fields[i][1] + '</label></li></ul>';
                count++;
              }
              console.log(html);
              $('#asdx').html(html);
            }
          });
        });
      });
    });
  </script>
{% endblock %}
